{% extends "../../../partials/layout.njk" %}

{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/breadcrumbs/macro.njk" import govukBreadcrumbs %}
{% from "moj/components/pagination/macro.njk" import mojPagination %}
{% from "../../../partials/miniProfile/macro.njk" import miniProfile %}
{% from "govuk/components/tabs/macro.njk" import govukTabs %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{% set pageTitle = applicationName + " - List contacts" %}
{% set title = "List contacts" %}
{% set mainClasses = "app-container govuk-body" %}

{% set searchLink = "/contacts/manage/prisoner-search/" + journey.id %}
{% set backLinkHref = "/contacts/manage/prisoner-search-results/" + journey.id %}
{% set tableHeaders = [
      {
        text: "Name"
      },
      {
        text: "Date of birth"
      },
      {
        text: "Address"
      },
      {
        text: "Relationship to prisoner"
      },
      {
        text: "Emergency contact"
      },
      {
        text: "Next of kin"
      },
      {
        text: "Approved"
      }
    ]
%}

{% macro prisonerDoesNotHaveAnyContactsMessage(journey, contactListType) %}
    <p>{{ journey.prisoner.firstName | convertToTitleCase }} {{ journey.prisoner.lastName | convertToTitleCase }} does not have any {{ contactListType }} contacts</p>
{% endmacro %}

{% block content %}

<div class="govuk-grid-row govuk-!-static-margin-bottom-5">
    <div class="govuk-grid-column-full">
        {{ govukBreadcrumbs({
        items: [
            { text: "Digital Prison Services", href: DPS_HOME_PAGE_URL },
            { text: "Contacts", href: "/" },
            { text: "Search", href: searchLink },
            { text: "Results", href: backLinkHref }
        ]
        }) }}
    </div>
</div>

{# Test the mini profile macro #}
{{ miniProfile(prisonerDetails, '/prisoner-image/' + prisonerDetails.prisonerNumber, digitalPrisonServicesUrl + '/prisoner/' + prisonerDetails.prisonerNumber) }}

{{ govukButton({
    text: "Add prisoner contact",
    href: "/"
}) }}

<span class="govuk-caption-l">Manage Contacts</span>
<h1 class="govuk-heading-l">{{ title }}</h1>
{% set activeContacts %}
    {% if activeContacts.length > 0 %}
        {{ govukTable({
            head: tableHeaders,
            rows: activeContacts | createContactsListRows
        }) }}
    {% else %}
        {{ prisonerDoesNotHaveAnyContactsMessage(journey, 'active') }}
    {% endif %}
{% endset %}

{% set inactiveContacts %}
    {% if inactiveContacts.length > 0 %}
        {{ govukTable({
            head: tableHeaders,
            rows: inactiveContacts | createContactsListRows
        }) }}
    {% else %}
        {{ prisonerDoesNotHaveAnyContactsMessage(journey, 'inactive') }}
    {% endif %}
{% endset %}

{{ govukTabs({
    items: [
        {
            label: "Active contacts",
            id: "active-contacts",
            panel: { html: activeContacts }
        },
        {
            label: "Inactive contacts",
            id: "inactive-contacts",
            panel: { html: inactiveContacts }
        }
    ]
}) }}

{% endblock %}

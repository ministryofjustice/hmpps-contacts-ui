{% from "govuk/components/table/macro.njk" import govukTable %}

{% macro linkedPrisonersTable(opts) %}

    {% set linkedPrisoners = opts.linkedPrisoners %}
    {% set contact = opts.contact %}

    {% set rows = [] %}
    {% for linkedPrisoner in linkedPrisoners  %}
        {% set prisonerNameAndNumberHtml %}
          {{ linkedPrisoner | formatNameLastNameFirst }}<br/>
          <span class="govuk-hint">{{ linkedPrisoner.prisonerNumber }}</span>
        {% endset %}
        {% set rows = (rows.push([
          { html: prisonerNameAndNumberHtml },
          { text: linkedPrisoner.prisonName },
          { text: linkedPrisoner.relationshipTypeDescription },
          { text: linkedPrisoner.relationshipToPrisonerDescription },
          { text: 'Active' if linkedPrisoner.isRelationshipActive else 'Inactive'  }
        ]), rows) %}
    {% endfor %}

    {{ govukTable({
      caption: "Prisoners linked to contact " + (contact | formatNameFirstNameFirst),
      captionClasses: "govuk-table__caption--l govuk-!-margin-bottom-6",
      firstCellIsHeader: false,
      head: [
        {
          text: "Name and prison number"
        },
        {
          text: "Establishment"
        },
        {
          text: "Relationship type"
        },
        {
          text: "Contactâ€™s relationship to the prisoner"
        },
        {
          text: "Relationship status"
        }
      ],
      rows: rows
    }) }}
{% endmacro %}
